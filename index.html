<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Recruitment task</title>
    <meta name="robots" content="noindex">
    <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.24/browser.min.js"></script>
    <script src="https://kit.fontawesome.com/1267997e0d.js" crossorigin="anonymous"></script>
    <style>
        body {
            background-color: #ffddc8;
            margin: 0;
            padding: 0;
        }

        .container {
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .todo {
            position: fixed;
            font-size: 1rem;
            background-color: #eeccb7;
            padding: 10px 30px;
            height: 100vh;
            border-right: black 3px solid;
            transition: left .4s ease-in-out;
            left: -505px;
        }

        .show {
            left: 0;
        }

        .arrow {
            font-size: 2rem;
            font-weight: 600;
            font-family: "Font Awesome 6 Free", sans-serif;
            background-color: #eeccb7;
            position: absolute;
            top: 40px;
            right: -49px;
            border-radius: 0 50% 50% 0;
            padding: 15px 20px 15px 10px;
            border-right: 3px solid black;
            border-top: 3px solid black;
            border-bottom: 3px solid black;
        }

        .revArrow {
            transform: scale(-1, 1);
            border-radius: 50% 0 0 50%;
            padding: 15px 10px 15px 20px;
            border-left: 3px solid black;
            border-right: none;
        }

        .arrow:hover {
            background-color: #ddbba6;
            cursor: pointer;
        }

        .add_worker {
            border: 1px solid black;
            padding: 2px;
            display: flex;
            flex-direction: column;
        }

        .add_worker section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 5px;
            border: 1px solid black;
            margin-bottom: 2px;
        }

        .add_worker section:last-of-type {
            margin-bottom: 0;
        }

        .add_worker section input {
            margin: 5px 0;
        }


        .holder {
            width: calc(100% + 100px);
            padding: 10px 0 30px 0;
            display: flex;
            justify-content: space-between;
        }

        .submit {
            width: 100%;
            height: 33px;
            margin: 5px auto;
            border: 1px solid black;
            border-radius: 2px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            background-color: #eeccb7;
        }

        .submit:hover {
            cursor: pointer;
            transform: scale(1.01);
            transition: transform .1s ease-in-out;
            background-color: #ddbba6;
        }

        .add_form {
            display: flex;
            justify-content: center;
            flex-direction: column;
        }

        .department_salary {
            margin: 0 auto;
        }

        .search {
            position: fixed;
            font-size: 2rem;
            top: 40px;
            right: 40px;
            padding: 15px;
            border: 3px solid black;
            border-radius: 50%;
            background-color: #eeccb7;

            display: flex;
            justify-content: center;
            align-items: center;
        }

        .search:hover {
            background-color: #ddbba6;
            cursor: pointer;
        }

        .search_form {
            position: relative;
            width: 70vw;
            height: 80vh;
            background-color: #eeccb7;
            border-radius: 20px;
        }

        .add_search_holder {
            position: fixed;
            width: 100vw;
            height: 100vh;
            top: 0;
            left: 0;
            background-color: rgba(82, 82, 82, 0.52);
            z-index: 2;

            display: flex;
            justify-content: center;
            align-items: center;
        }

        .close {
            position: absolute;
            top: 20px;
            right: 25px;
            font-size: 1.5rem;
        }

        .close:hover {
            cursor: pointer;
            transform: scale(1.2);
        }
        .searching_form{
            width: 50%;
            margin: 20px auto;
            display: flex;
            flex-direction: column;
        }
        .searching_form_holder{
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
        }
        .searching_form_holder:last-of-type{
            flex-direction: column;
        }
        .values{
            display: inline;
        }
        .range_holder{
            display: flex;
            justify-content: space-between;
        }
        .wrapper{
            display: flex;
            height: 30px;
        }
        .wrapper div{
            position: relative;
            width: 100%;
        }
        input[type='range']{
            appearance: none;
            width: 100%;
            outline: none;
            position: absolute;
            margin: auto;
            top: 0;
            bottom: 0;
            background-color: transparent;
            pointer-events: none;
        }
        .slider{
            width: 100%;
            height: 5px;
            background-color: #d5d5d5;
            position: absolute;
            margin: auto;
            top: 0;
            bottom: 0;
            border-radius: 5px;
        }
        /*input[type='range']::-webkit-slider-runnable-track{*/
        /*    appearance: none;*/
        /*    height: 5px;*/
        /*}*/
        input[type='range']::-webkit-slider-thumb{
            appearance: none;
            height: 1.5em;
            width: 1.5em;
            background-color: #3264fe;
            cursor:pointer;
            border-radius: 50%;
            pointer-events: auto;
            margin-top: -1px;
        }
        .search_title{
            left: 25%;
            position: relative;
        }
        .search_title + table{
            position: relative;
            left: 25%;
        }
        .searched_workers{
            max-height: 400px;
        }
        .add_form_holder{
            position: relative;
            width: 70vw;
            background-color: #eeccb7;
            border-radius: 20px;
            display: flex;
            align-items: center;
            flex-direction: column;
            padding-bottom: 30px;
        }
        .add {
            position: fixed;
            font-size: 2rem;
            top: 120px;
            right: 40px;
            padding: 15px 17px;
            border: 3px solid black;
            border-radius: 50%;
            background-color: #eeccb7;

            display: flex;
            justify-content: center;
            align-items: center;
        }

        .add:hover {
            background-color: #ddbba6;
            cursor: pointer;
        }
        .trash{
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2px 2px;
            color: #a20202;
        }
        .trash:hover{
            transform: scale(1.02);
            transition: transform ease-in-out .2s;
            cursor:pointer;
            color: #a10101;
        }
        .urWorker{
            margin: 0 auto;
        }
        .search_info{
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%,-100%);
        }
    </style>
</head>
<body>
<div id="app">
</div>
<script type="text/babel">

    class TaskList extends React.Component {
        constructor() {
            super();
            this.state = {
                taskList: [
                    {
                        "title": "Add form to add new worker",
                        "completed": true,
                        "subtaskList": [
                            {"title": "firstName", "completed": true},
                            {"title": "lastName", "completed": true},
                            {"title": "department", "completed": true},
                            {"title": "salary amount and currency", "completed": true}
                        ]
                    },
                    {
                        "title": "Add search form",
                        "completed": true,
                        "subtaskList": [
                            {"title": "person (text)", "completed": true},
                            {"title": "department (multiple choice)", "completed": true},
                            {"title": "salary (range)", "completed": true}
                        ]
                    },
                    {
                        "title": "Add summary of salary per department",
                        "completed": true
                    },
                    {
                        "title": "Other improvements (feel free to add other improvements)",
                        "completed": true
                    }
                ]
            }
        }

        render() {
            const {taskList} = this.state;
            return (<ol>
                {taskList.map((task, tIdx) => (
                    <li key={tIdx}>{task.title} {task.completed ? "✅" : "❌"}
                        <ol type="a">
                            {task.subtaskList && task.subtaskList.map((subtask, stIdx) => (
                                <li key={stIdx}>{subtask.title} {subtask.completed ? "✅" : "❌"}</li>))}
                        </ol>
                    </li>
                ))}
            </ol>);
        }
    }

    const WorkerList = () => {
        const [workerList, setWorker] = React.useState([]);
        const [name, setName] = React.useState('');
        const [surname, setSurname] = React.useState('');
        const [department, setDepartment] = React.useState('');
        const [salary, setSalary] = React.useState('');
        const salarySum = workerList.reduce((acc, i) => acc + i.salary.amount, 0);
        const [allDepartments, setDepartments] = React.useState([]);
        const [allNames,setNames] = React.useState([]);
        const [departmentSalary, setDepartmentSalary] = React.useState([]);
        const [isVisible, setVisible] = React.useState(false);
        const [isAddVisible, setAddVisible] = React.useState(false);
        const [isSearched, setSearched] = React.useState(false);
        const [searchName,setSearchName] = React.useState('');
        const [searchDepartment, setSearchDepartment] = React.useState('');
        const [searchSalaryMin,setSearchSalaryMin] = React.useState(0);
        const [searchSalaryMax,setSearchSalaryMax] = React.useState(0);
        const [searchedWorkers,setSearchedWorkers] = React.useState([]);
        const [salaryMax, setMax] = React.useState(0);
        const [isWorkers,setWorkers] = React.useState(false);

        const departments = [];
        const names = [];
        const salaries = [];

        React.useEffect(() => {
            if (JSON.parse(localStorage.getItem('Workers')).length === 0){
                setWorkers(true);
            }
            if (localStorage.getItem('Workers') === null){
                const workers = [
                    {
                        "firstName": "John",
                        "lastName": "Smith",
                        "department": "IT",
                        "salary": {"amount": 3000, "currency": "USD"}
                    },
                    {
                        "firstName": "Jane",
                        "lastName": "Doe",
                        "department": "IT",
                        "salary": {"amount": 3000.50, "currency": "USD"}
                    },
                    {
                        "firstName": "Bob",
                        "lastName": "Colman",
                        "department": "Sales",
                        "salary": {"amount": 9000, "currency": "USD"}
                    },
                    {
                        "firstName": "Barbara",
                        "lastName": "O'Connor",
                        "department": "Sales",
                        "salary": {"amount": 4000, "currency": "USD"}
                    },
                    {
                        "firstName": "Adam",
                        "lastName": "Murphy",
                        "department": "Administration",
                        "salary": {"amount": 2000, "currency": "USD"}
                    }
                ]
               localStorage.setItem('Workers',JSON.stringify(workers));
                setWorkers(false);
            }
            setWorker(JSON.parse(localStorage.getItem('Workers')));
        },[]);


        React.useEffect(() => {
            workerList.forEach(el => {
                departments.push(el.department);
                names.push(el.firstName);
                salaries.push(el.salary.amount);
            });

            setMax(Math.max(...salaries));
            setSearchSalaryMax(Math.max(...salaries));

            setDepartments(departments.filter((v, i) => departments.indexOf(v) === i));
            setNames(names.filter((v,i) => names.indexOf(v) === i));

            const workersList = JSON.parse(localStorage.getItem('Workers'));
            workersList.forEach((worker, index) =>{
                worker.index = index + 1;
            })
            localStorage.setItem('Workers',JSON.stringify(workersList));


        }, [workerList]);

        React.useEffect(() => {
            for (let i = 0; i < allDepartments.length; i++) {
                let salarySum = 0;
                workerList.forEach(el => {
                    if (el.department === allDepartments[i]) {
                        salarySum += el.salary.amount;
                    }
                })
                setDepartmentSalary(prev => [...prev, salarySum]);
            }
        }, [allDepartments]);

        const AddWorker = event => {
            event.preventDefault();
            if (name !== '' && surname !== '' && department !== '' && salary !== '' && salary !== 0) {
                const worker = {
                    "firstName": name,
                    "lastName": surname,
                    "department": department,
                    "salary": {"amount": parseInt(salary), "currency": "USD"},
                    'index': JSON.parse(localStorage.getItem('Workers')).length + 1,
                };
                const workers = JSON.parse(localStorage.getItem('Workers'));
                localStorage.clear();
                workers.push(worker);
                localStorage.setItem('Workers',JSON.stringify(workers));
                setWorker(workers);
                setName('');
                setSurname('');
                setDepartment('');
                setSalary('');
                setDepartmentSalary([]);
                setAddVisible(false);
                setWorkers(false);
            }
        }

        const ShowSearchForm = () => {
            setVisible(true);
        }

        const HideForm = () => {
            setVisible(false);
            setAddVisible(false);
        }

        const ShowAddForm = () => {
            setAddVisible(true);
        }

        let firstSlider = document.getElementById('salary_1');
        let secondSlider = document.getElementById('salary_2');
        let displayMinValue = document.querySelector('.min');
        let displayMaxValue = document.querySelector('.max');

        const Change1 = e =>{
                setSearchSalaryMin(e.currentTarget.value);


                if (secondSlider.value - firstSlider.value <= 0){
                    firstSlider.value = secondSlider.value;
                    setSearchSalaryMin(secondSlider.value);
                }
                displayMinValue.textContent = firstSlider.value;
                const slider = document.querySelector('.slider');
                slider.style.background = `linear-gradient(to right, #dadae5 ${firstSlider.value / salaryMax * 100}%, #3264fe ${firstSlider.value / salaryMax * 100}%, #3264fe ${secondSlider.value / salaryMax * 100}%, #dadae5 ${secondSlider.value / salaryMax * 100}%)`
        }

        const Change2 = e => {
            setSearchSalaryMax(e.currentTarget.value);

            if (secondSlider.value - firstSlider.value <= 0) {
                secondSlider.value = firstSlider.value;
                setSearchSalaryMax(firstSlider.value);
            }
            displayMaxValue.textContent = secondSlider.value;
            const slider = document.querySelector('.slider');
            slider.style.background = `linear-gradient(to right, #dadae5 ${firstSlider.value / salaryMax * 100}%, #3264fe ${firstSlider.value / salaryMax * 100}%, #3264fe ${secondSlider.value / salaryMax * 100}%, #dadae5 ${secondSlider.value / salaryMax * 100}%)`

        }

        const Search = event =>{
            event.preventDefault();
            setSearched(true);
            setSearchedWorkers([]);

            if (searchName === '' && searchDepartment === ''){
                workerList.forEach(worker =>{
                   if (worker.salary.amount >= searchSalaryMin && worker.salary.amount<= searchSalaryMax){
                       const searchedWorker = {
                           'firstName': worker.firstName,
                           'lastName': worker.lastName,
                           'department': worker.department,
                           'salary':{ 'amount': worker.salary.amount, 'currency': worker.salary.currency}
                       }
                       setSearchedWorkers(prev=>[...prev, searchedWorker])
                   }
                })
            }else if (searchName !== ''){
                workerList.forEach(worker =>{
                    if (worker.firstName === searchName && worker.salary.amount >= searchSalaryMin && worker.salary.amount<= searchSalaryMax){
                        const searchedWorker = {
                            'firstName': worker.firstName,
                            'lastName': worker.lastName,
                            'department': worker.department,
                            'salary':{ 'amount': worker.salary.amount, 'currency': worker.salary.currency}
                        }
                        setSearchedWorkers(prev=>[...prev, searchedWorker])
                    }
                })
            }else if (searchDepartment !== ''){
                workerList.forEach(worker =>{
                    if (worker.department === searchDepartment && worker.salary.amount >= searchSalaryMin && worker.salary.amount<= searchSalaryMax){
                        const searchedWorker = {
                            'firstName': worker.firstName,
                            'lastName': worker.lastName,
                            'department': worker.department,
                            'salary':{ 'amount': worker.salary.amount, 'currency': worker.salary.currency}
                        }
                        setSearchedWorkers(prev=>[...prev, searchedWorker])
                    }
                })
            }else {
                workerList.forEach(worker => {
                    if (worker.firstName === searchName && worker.department === searchDepartment && worker.salary.amount >= searchSalaryMin && worker.salary.amount <= searchSalaryMax) {
                        const searchedWorker = {
                            'firstName': worker.firstName,
                            'lastName': worker.lastName,
                            'department': worker.department,
                            'salary': {'amount': worker.salary.amount, 'currency': worker.salary.currency}
                        }
                        setSearchedWorkers(prev => [...prev, searchedWorker]);
                    }
                })
            }
        }

        const  Delete = event => {
            const tr = event.currentTarget.parentElement;
            const prevWorkers = JSON.parse(localStorage.getItem('Workers'));
            prevWorkers.forEach(worker =>{
                if (tr.firstElementChild.textContent === worker.index + '.'){
                    prevWorkers.splice(worker.index - 1,1);
                    setWorker(prevWorkers);
                    setDepartmentSalary([]);
                    localStorage.clear();
                    localStorage.setItem('Workers',JSON.stringify(prevWorkers));
                    if (workerList.length === 1){
                        setWorkers(true);
                    }
                }
            })
        }

        return (
            <div className="holder">
                {isAddVisible ? (
                    <div className="add_search_holder">
                        <div className="add_form_holder">
                            <h2>Add Worker</h2>
                            <form className="add_form" onSubmit={(e) => {AddWorker(e)}}>
                                <div className="add_worker">
                                    <section>
                                        <label htmlFor="name">Name: </label>
                                        <input type="text" id="name" placeholder="Rob" value={name} onChange={e => {
                                            setName(e.currentTarget.value)
                                        }}/>
                                    </section>
                                    <section>
                                        <label htmlFor="surname">Surname: </label>
                                        <input type="text" id="surname" placeholder="Smith" value={surname} onChange={e => {
                                            setSurname(e.currentTarget.value)
                                        }}/>
                                    </section>
                                    <section>
                                        <label htmlFor="department">Department: </label>
                                        <input type="text" id="department" placeholder="IT" value={department} onChange={e => {
                                            setDepartment(e.currentTarget.value)
                                        }}/>
                                    </section>
                                    <section>
                                        <label htmlFor="salary">Salary: </label>
                                        <input type="number" min="0" id="salary" placeholder="2000" value={salary} onChange={e => {
                                            setSalary(e.currentTarget.value)
                                        }}/>
                                    </section>
                                </div>
                                <button className="submit"><i className="fa-solid fa-plus"/></button>
                            </form>
                            <i className="fa-solid fa-xmark close" onClick={HideForm}/>
                        </div>
                    </div>
                    ): (
                        <div className="add" onClick={ShowAddForm}>
                            <i className="fa-solid fa-plus"/>
                        </div>
                )}
                {isWorkers && (
                    <h1 className="urWorker">Add Your Workers...</h1>
                )}
                {!isWorkers && (
                <div className="workers">
                    <h2>Workers</h2>
                    <table border="1">
                        <tbody>
                        {workerList.map((worker, index) => (
                            <tr key={index}>
                                <td>{index + 1}.</td>
                                <td>{worker.firstName}</td>
                                <td>{worker.lastName}</td>
                                <td>{worker.department}</td>
                                <td>{worker.salary.amount} {worker.salary.currency}</td>
                                <td className="trash" onClick={e =>{Delete(e)}}>
                                    <i className="fa-solid fa-trash-can tra"/>
                                </td>
                            </tr>
                        ))}
                        </tbody>
                        <tfoot>
                        <tr>
                            <td colSpan="3"/>
                            <td>Summary</td>
                            <td>{salarySum} USD</td>
                        </tr>
                        </tfoot>
                    </table>
                </div>
                )}
                {!isWorkers && (
                    <div className="departments">
                        <h2>Department salary</h2>
                        <table border='1' className='department_salary'>
                            <tbody>
                            {allDepartments.map((department, index) => {
                                return (
                                    <tr key={index}>
                                        <td>{index + 1}.</td>
                                        <td>{department}</td>
                                        <td>{departmentSalary[index]} USD</td>
                                    </tr>
                                )
                            })}
                            </tbody>
                        </table>
                    </div>
                )}
                {isVisible ? (
                    <div className='add_search_holder'>
                        <div className="search_form">
                            {!isWorkers ? (
                                <div>
                                    <h2 className="search_title">Search</h2>
                                    <form className="searching_form" onSubmit={e => {Search(e)}}>
                                        <div className="searching_form_holder">
                                            <label htmlFor="name">Name:</label>
                                            <input type="text" list="names" id="name" value={searchName} onChange={e => {setSearchName(e.currentTarget.value)}}/>
                                            <datalist id="names">
                                                {allNames.map((name, index) => <option key={index} value={name}/>)}
                                            </datalist>
                                        </div>
                                        <div className="searching_form_holder">
                                            <label htmlFor="department">Department:</label>
                                            <select id="department" value={searchDepartment} onChange={e => {setSearchDepartment(e.currentTarget.value)}}>
                                                <option value=''>--Select--</option>
                                                {allDepartments.map((department, index) => <option key={index} value={department}>{department}</option>)}
                                            </select>
                                        </div>
                                        <div className="searching_form_holder">
                                            <div className="range_holder">
                                                <label >Salary:</label>
                                                <div className="values"><span className="min">0</span> - <span className="max">{salaryMax}</span></div>
                                            </div>
                                            <div className="wrapper">
                                                <div>
                                                    <section className="slider"/>
                                                    <input type="range" id="salary_1" min='0' max={salaryMax}  defaultValue={searchSalaryMin} onChange={e => {Change1(e)}}/>
                                                    <input type="range" id="salary_2" min="0" max={salaryMax}  defaultValue={searchSalaryMax} onChange={e => {Change2(e)}}/>
                                                </div>
                                            </div>
                                            <span id="current_value"/>
                                        </div>
                                        <button>SEARCH</button>
                                    </form>
                                </div>
                            ) : (
                                <h1 className="search_info">First Add Worker</h1>
                            )}
                            <i className="fa-solid fa-xmark close" onClick={HideForm}/>
                            {isSearched && (
                                <section className="searched_worker">
                                    <h2 className="search_title">Workers</h2>
                                    <table border="1">
                                        {searchedWorkers.map((worker,index)=>(
                                            <tr key={index}>
                                                <td>{index + 1}.</td>
                                                <td>{worker.firstName}</td>
                                                <td>{worker.lastName}</td>
                                                <td>{worker.department}</td>
                                                <td>{worker.salary.amount} {worker.salary.currency}</td>
                                            </tr>
                                        ))}
                                    </table>
                                </section>
                            )}
                        </div>
                    </div>
                ) : (
                    <div className="search" onClick={ShowSearchForm}>
                        <i className="fa-solid fa-magnifying-glass"/>
                    </div>
                )}
            </div>);
    }


    const showHints = event => {
        const hint = document.querySelector('.todo');

        hint.classList.toggle('show');
        event.currentTarget.classList.toggle('revArrow');
    }

    const Hover = () => {
        const hint = document.querySelector('.todo');
        hint.style.backgroundColor = '#ddbba6';
    }
    const Leave = () => {
        const hint = document.querySelector('.todo');
        hint.style.backgroundColor = '#eeccb7';
    }

    ReactDOM.render(
        <div style={{display: "flex", gap: "2em"}}>
            <div className="todo">
                <h1>TODO</h1>
                <TaskList/>
                <h2>Hints</h2>
                <ol>
                    <li>
                        yarn global add browser-sync<br/>
                        browser-sync --watch .
                    </li>
                    <li>&lt;datalist&gt;</li>
                </ol>
                <i className="fa-solid fa-angle-right arrow" onClick={e => {
                    showHints(e)
                }} onMouseEnter={Hover} onMouseLeave={Leave}/>
            </div>
            <div className="container">
                <WorkerList/>
            </div>
        </div>,
        document.getElementById('app')
    );
</script>
</body>
</html>
